



<!doctype html>
<html lang="en" class="no-js">
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/timeago.js/4.0.2/timeago.min.js"></script>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="The #1 reference for developers working with Saxo Bank's OpenAPI.">
      
      
      
        <meta name="author" content="Gid van der Ven">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../..">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.0">
    
    
      
        <title>WebSocket Streaming - The Developer's Guide to Saxo's OpenAPI</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.82a18eb7.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.3e3d1dff.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../css/custom.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="black" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#introduction" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="The Developer's Guide to Saxo's OpenAPI" class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              The Developer's Guide to Saxo's OpenAPI
            </span>
            <span class="md-header-nav__topic">
              
                WebSocket Streaming
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../.." class="md-tabs__link">
          Home
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../" class="md-tabs__link md-tabs__link--active">
          The Basics
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../individual/" class="md-tabs__link">
          Individual Developers
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../institutional/" class="md-tabs__link">
          Institutional Developers
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../third-party/" class="md-tabs__link">
          3rd-Party App Developers
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../updates/" class="md-tabs__link">
          Updates
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="The Developer's Guide to Saxo's OpenAPI" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    The Developer's Guide to Saxo's OpenAPI
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/gidven/saxo-openapi-guide/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Home
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Home
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../.." title="Welcome" class="md-nav__link">
      Welcome
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../usage/" title="Using this Guide" class="md-nav__link">
      Using this Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tools/" title="Useful Tools" class="md-nav__link">
      Useful Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../support/" title="Requesting Support" class="md-nav__link">
      Requesting Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../disclaimer/" title="Disclaimer" class="md-nav__link">
      Disclaimer
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      The Basics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        The Basics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Core Business Concepts
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Core Business Concepts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../core-business-concepts/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core-business-concepts/client-user-account/" title="The Client-User-Account Model" class="md-nav__link">
      The Client-User-Account Model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core-business-concepts/retrieving-entity-data/" title="Retrieving Entity Data" class="md-nav__link">
      Retrieving Entity Data
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3" checked>
    
    <label class="md-nav__link" for="nav-2-3">
      Fundamental Programming Concepts
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Fundamental Programming Concepts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        WebSocket Streaming
      </label>
    
    <a href="./" title="WebSocket Streaming" class="md-nav__link md-nav__link--active">
      WebSocket Streaming
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview-of-websocket-streaming" class="md-nav__link">
    Overview of WebSocket Streaming
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#removing-a-subscription" class="md-nav__link">
    Removing a Subscription
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decoding-data-messages" class="md-nav__link">
    Decoding Data Messages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disconnecting-and-reconnecting" class="md-nav__link">
    Disconnecting and Reconnecting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resetting-subscriptions" class="md-nav__link">
    Resetting Subscriptions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#throttling" class="md-nav__link">
    Throttling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#re-authorizing" class="md-nav__link">
    Re-Authorizing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#control-messages" class="md-nav__link">
    Control Messages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keeping-state-on-the-client-side" class="md-nav__link">
    Keeping State on the Client Side
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      Frequently Asked Questions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        Frequently Asked Questions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../faq/" title="FAQ Guide" class="md-nav__link">
      FAQ Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../faq/authentication/" title="How do I authenticate?" class="md-nav__link">
      How do I authenticate?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Individual Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Individual Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../individual/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Institutional Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Institutional Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../institutional/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      3rd-Party App Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        3rd-Party App Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../third-party/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Updates
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Updates
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../updates/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../updates/changes/" title="Planned Changes" class="md-nav__link">
      Planned Changes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-3" type="checkbox" id="nav-6-3">
    
    <label class="md-nav__link" for="nav-6-3">
      Release Notes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-3">
        Release Notes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../updates/release-notes/" title="Guide" class="md-nav__link">
      Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../updates/release-notes/2019-12-13/" title="2019-12-13 - Breaking" class="md-nav__link">
      2019-12-13 - Breaking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../updates/release-notes/2019-11-25/" title="2019-11-25" class="md-nav__link">
      2019-11-25
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../updates/release-notes/2019-09-03/" title="2019-09-03" class="md-nav__link">
      2019-09-03
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview-of-websocket-streaming" class="md-nav__link">
    Overview of WebSocket Streaming
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#removing-a-subscription" class="md-nav__link">
    Removing a Subscription
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decoding-data-messages" class="md-nav__link">
    Decoding Data Messages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disconnecting-and-reconnecting" class="md-nav__link">
    Disconnecting and Reconnecting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resetting-subscriptions" class="md-nav__link">
    Resetting Subscriptions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#throttling" class="md-nav__link">
    Throttling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#re-authorizing" class="md-nav__link">
    Re-Authorizing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#control-messages" class="md-nav__link">
    Control Messages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keeping-state-on-the-client-side" class="md-nav__link">
    Keeping State on the Client Side
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
              <h1 class="article-title">WebSocket Streaming</h1>
            
            <div class="md-source-date">
              <small>
                
                Last update: <a href="https://github.com/gidven/saxo-openapi-guide/commits/master/docs/basics/fundamental-programming-concepts/websocket-streaming.md" title="Show commits" class="timeago" datetime="2020-03-06 12:28:24 UTC">2020-03-06 12:28:24 UTC</a>
                &nbsp;&nbsp;&nbsp;
                ~10&nbsp;minutes&nbsp;to&nbsp;read
                <br>
                <a href="https://github.com/gidven/saxo-openapi-guide/blob/master/docs/basics/fundamental-programming-concepts/websocket-streaming.md" title="Make a contribution on GitHub!">Edit&nbsp;on&nbsp;GitHub&nbsp;<i class="fa fa-pencil-square-o" aria-hidden="true"></i></a>
                &nbsp;&nbsp;&nbsp;
                <a href="https://github.com/gidven/saxo-openapi-guide/blame/master/docs/basics/fundamental-programming-concepts/websocket-streaming.md" title="Show blame">1&nbsp;author&nbsp;<i class="fa fa-github" aria-hidden="true"></i></a>
                &nbsp;&nbsp;&nbsp;
                <a href="https://github.com/gidven/saxo-openapi-guide/commits/master/docs/basics/fundamental-programming-concepts/websocket-streaming.md" title="Show commits">8&nbsp;commits&nbsp;<i class="fa fa-file-text-o" aria-hidden="true"></i></a>
                
              </small>
              
            </div>
          
          <span class="article-text-content">
                <details class="abstract"><summary>Abstract</summary><p>This article provides an in-depth walkthrough of the OpenAPI WebSocket implementation. It is recommended for anyone working on OpenAPI streaming to study the below carefully, as it includes important considerations around correct management of WebSocket connections and optimal use of this solution.</p>
</details>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>The OpenAPI supports streaming using a standard implementation of the WebSocket Protocol, as described in <a href="https://tools.ietf.org/html/rfc6455">RFC6455</a>. Given that most of the information available to users is in constant flux (such as account balance, charts, quotes, position P&amp;L, etc), using polling for <em>each</em> dynamic element that could be relevant in an application is not a viable solution. Instead, creating a single WebSocket connection and adding/removing subscriptions on-demand offers greatly reduced overhead and optimal latency.<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup></p>
<p>In a standard use-case, an application (web, mobile, or native) creates a WebSocket connection and subscribes to the data that it requires. The subscriptions change constantly (depending on the contextual requirements) while the WebSocket connection persists. This allows for a fairly lean setup: the connection is created once (the 'channel'), and the data sent over this connection is controlled with individual <code>POST</code> and <code>DELETE</code> requests to the associated OpenAPI endpoints. The majority of endpoints support subscriptions alongside standard <code>GET</code> requests, which can be identified by the <code>.../subscriptions</code> suffix. Some examples:</p>
<ul>
<li><code>port/v1/netpositions/subscriptions/</code>, which provides real-time updates of net positions across a client's accounts. This includes details such as <code>Exposure</code>, <code>ProfitLossOnTrade</code>, and <code>ConversionRateCurrent</code>, which is used to convert between instrument currency and account currency in real time.</li>
<li><code>chart/v1/charts/subscriptions/</code>, which is used to retrieve live OHLC data and (recent) historic bars, which lays the groundworks for interactive charts, indicators, strategies, etc.</li>
<li><code>trade/v1/infoprices/subscriptions/</code>, which is used to retrieve 'informational' prices for display purposes in product overviews, chart overlays, and watchlists. This endpoint also includes functionality to retrieve in-depth price details such as daily high/low and %-change values.</li>
</ul>
<p>Depending on the specific context, an (imaginary) application might for instance follow the below sequence of OpenAPI operations while the user interacts with its UI:</p>
<ol>
<li>When a user logs on, the app creates a WebSocket connection which will be used throughout the below steps.</li>
<li>While the UI loads, the app subscribes to <code>port/v1/balances/subscriptions/</code> to show the client an overview of their current account state. This is a persistent element in the UI and the subscription will be kept alive for as long as the client is using the app.</li>
<li>The app has a feature to draw charts, and the user selects the EURUSD Forex cross as the instrument for this chart. The app subscribes to <code>chart/v1/charts/subscriptions/</code> to simultaneously create a live-updating price stream and obtain historic bars.</li>
<li>The user switches to EURGBP in the chart. The app deletes the previous subscription as this is not longer required, and re-subscribes to <code>chart/v1/charts/subscriptions/</code> to pull out data for EURGBP.</li>
<li>The user closes the app. Any remaining subscriptions are removed and the WebSocket connection is closed.</li>
</ol>
<p>Note that all data in the above example is transferred over a single persistent 'channel' (the WebSocket connection).</p>
<h2 id="overview-of-websocket-streaming">Overview of WebSocket Streaming<a class="headerlink" href="#overview-of-websocket-streaming" title="Permanent link">&para;</a></h2>
<div class="mermaid">sequenceDiagram
    participant C as Client Application
    participant S as OpenAPI &lt;br&gt; WebSocket Server
    participant O as OpenAPI &lt;br&gt; Endpoints

    C-&gt;&gt;S: 1 - Initiate Connection
    S-&gt;&gt;C: 2 - Receive Confirmation
    C-&gt;&gt;O: 3 - Create Subscription
    O-&gt;&gt;C: 4 - Receive Snapshot Data
    O-&gt;&gt;S: 5 - Initiate Streaming

    loop streaming
        S--&gt;&gt;C: 6 - Receive Updates
    end</div>

<p>The sequence above represents the standard flow to create a new WebSocket connection and subscribe to streaming data. It involves the following processes:</p>
<ol>
<li>
<p><strong>Initiate Connection.</strong> The client application creates a WebSocket connection by sending a request to the OpenAPI WebSocket Server (or 'streaming server', which is located on <code>streaming.saxobank.com</code>). This request, also called the 'opening handshake', follows <a href="https://tools.ietf.org/html/rfc6455#section-1.3">standard WebSocket protocol</a> and includes two additional elements:</p>
<ul>
<li>The <code>ContextId</code> parameter: a unique ID that identifies this connection. This ID is generated by the client application. Every API interaction that involves streaming should include this ID (see step 3 below). Example: <code>ContextId=MyApp123abc</code>. Make sure to create a sufficiently long random string to prevent potential clashes with other applications. The streaming server will respond with <code>HTTP 409 Conflict</code> if the ContextId is already used for a different connection.</li>
<li>The <code>Authorization</code> header: standard authorization header containing a valid access token. Can also be sent as parameter if the client-side library does not support initiating WebSocket connections with custom headers. Example: <code>Authorization=Bearer%20[token]</code>.</li>
</ul>
<div class="superfences-tabs">
<input name="__tabs_1" type="radio" id="__tab_1_0" checked="checked" />
<label for="__tab_1_0">With Auth Header</label>
<div class="superfences-content"><pre class="codehilite"><code class="language-HTTP">GET /sim/openapi/streamingws/connect?ContextId=[ID] HTTP/1.1
Host: streaming.saxobank.com
Authorization: Bearer [token]
Connection: Upgrade
Upgrade: WebSocket
Sec-WebSocket-Key: [auto-generated key]
Sec-WebSocket-Version: 13</code></pre></div>
<input name="__tabs_1" type="radio" id="__tab_1_1" />
<label for="__tab_1_1">With Auth Parameter</label>
<div class="superfences-content"><pre class="codehilite"><code class="language-HTTP">GET /sim/openapi/streamingws/connect?ContextId=[ID]&amp;Authorization=Bearer%20[token] HTTP/1.1
Host: streaming.saxobank.com
Connection: Upgrade
Upgrade: WebSocket
Sec-WebSocket-Key: [auto-generated key]
Sec-WebSocket-Version: 13</code></pre></div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>In many client-side libraries, the URL that is required to initiate a WebSocket connection is usually composed as: <code>wss://host/path</code>, replacing the <code>http</code> protocol prefix (which is only used on initiation - the connection is upgraded afterwards).</p>
<p>In JavaScript for example, initiating a WebSocket connection requires the following code:</p>
<pre class="codehilite"><code class="language-JavaScript">let connection = new WebSocket("wss://example.com/streaming?parameter=123")</code></pre>

</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The current WebSocket version supported by the OpenAPI is <code>13</code>. Client libraries using outdated versions will receive a <code>HTTP 426 Upgrade Required</code> response when attempting to connect to the streaming server.</p>
</div>
</li>
<li>
<p><strong>Receive Confirmation.</strong> The streaming server responds with <code>HTTP 101 Switching Protocols</code> to confirm that the connection has been established. This response includes a <code>Connection: Upgrade</code> and a <code>Upgrade: websocket</code> header, as well as a hash of the key provided by the client in the <code>Sec-WebSocket-Accept</code> header, which prevents caching proxies from interfering with the opening handshake.</p>
<pre class="codehilite"><code class="language-HTTP">HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Cache-Control: private
Sec-WebSocket-Accept: [hashed key]
...</code></pre>

</li>
<li>
<p><strong>Create Subscription.</strong> At this point, a connection is established but no subscriptions have been created (the 'channel' is empty). In order to initiate a subscription, the client application sends a POST request to a <code>.../subscriptions</code> endpoint in the OpenAPI.<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup> For example, a price subscription for the EURUSD FX cross (UIC 21) can be created by sending the following POST request to the <code>trade/v1/infoprices/subscriptions/</code> endpoint:</p>
<pre class="codehilite"><code class="language-HTTP">POST /sim/openapi/trade/v1/infoprices/subscriptions/ HTTP/1.1
Host: gateway.saxobank.com
Authorization: Bearer [token]
Content-Type: application/json
Accept: */*
Cache-Control: no-cache
Accept-Encoding: gzip, deflate
Content-Length: 127
{
  "Arguments": {
    "Uics": "21",
    "AssetType": "FxSpot"
  },
  "ContextId": "MyContextID",
  "ReferenceId": "SubscriptionReference"
}</code></pre>

<p>Notice that this subscription request must contain a valid access token, and identifies the WebSocket connection using the <code>ContextId</code> field, which must match the ID set on the initial connection request (see step 1 above). This individual subscription is identified by its <code>ReferenceId</code>, which is set by the client application and can be used to adjust or cancel the subscription (without disconnecting the WebSocket). Note that each individual subscription must be created with a unique <code>ReferenceId</code> within the context of the WebSocket connection.</p>
</li>
<li>
<p><strong>Receive Snapshot Data.</strong> The OpenAPI responds with <code>HTTP 201 Created</code> to signal that the client subscribed successfully. In the response to the subscription request, the OpenAPI sends out a snapshot of the current state of the data requested by the client application. This is the starting point of the subscription and it includes <em>all</em> available fields. The EURUSD price subscription for instance contains Bid/Ask prices and further details around the quote, such as <code>Amount</code>, which automatically defaults to 100K if it is not specified in the subscription request:</p>
<pre class="codehilite"><code class="language-JSON">{
  "ContextId": "MyContextID",
  "Format": "application/json",
  "InactivityTimeout": 30,
  "ReferenceId": "SubscriptionReference",
  "RefreshRate": 1000,
  "Snapshot": {
    "Data": [
      {
        "AssetType": "FxSpot",
        "LastUpdated": "2020-02-11T09:38:20.553000Z",
        "PriceSource": "SBFX",
        "Quote": {
          "Amount": 100000,
          "Ask": 1.09143,
          "Bid": 1.09141,
          "DelayedByMinutes": 0,
          "ErrorCode": "None",
          "Mid": 1.09142,
          "PriceSource": "SBFX",
          "PriceSourceType": "Firm",
          "PriceTypeAsk": "Tradable",
          "PriceTypeBid": "Tradable"
      },
      "Uic": 21
      }
    ]
  },
  "State": "Active"
}</code></pre>

</li>
<li>
<p><strong>Initiate Streaming.</strong> Behind the scenes, the OpenAPI automatically instructs the streaming server to start sending updates on the WebSocket connection for the newly-created subscription. These updates will be buffered if the subscription request is received before the WebSocket connection is created to ensure consistency on the client side.</p>
</li>
<li>
<p><strong>Receive Updates.</strong> The client now receives data messages through the WebSocket connection. These messages are sent as a stream over a series of binary WebSocket frames. Each WebSocket frame can contain multiple data messages, and data messages can be split over several WebSocket frames, in which case a continuation frame follows. The <code>FIN</code> bit on each frame indicates whether the contained data completes a data message (see specification <a href="https://tools.ietf.org/html/rfc6455#section-5.2">here</a>). Frame B in the below diagram only contains part of data message 3, which should be completed using the first half of frame C. Most client libraries handle these cases automatically without requiring additional configuration.</p>
<pre class="codehilite"><code>                    +---------------+-------------+-------------+
WebSocket frame:    |   A     FIN=1 |   B   FIN=0 |   C   FIN=1 |
                    +-------+-------+-------------+-----+-------+
Data message:       |   1   |   2   |         3         |   4   |
                    +-------+-------+-------------------+-------+</code></pre>

<p>The binary data contained in each data message needs to be decoded by the client application (see the byte layout below). The binary data includes the <code>RefrenceId</code> of the subscription that it the message belongs to. The payload of the data messages is always encoded in JSON format, which contains <em>only</em> fields that have changed since the previous message/initial snapshot (so-called <strong>'delta updates'</strong>).<sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup> For instance, the first update message for the EURUSD price subscription created above could look like this:</p>
<pre class="codehilite"><code class="language-JSON">[
  {
    "LastUpdated": "2020-02-11T09:38:30.972000Z",
    "Quote": {
      "Ask": 1.09148,
      "Bid": 1.09147,
      "Mid": 1.091475
    },
    "Uic": 21
  }
]</code></pre>

<p>Notice that the <em>only</em> static element in this message is the <code>Uic</code> field, which is required to determine which object should be updated on the client side. The updated fields are merged with the snapshot received in step 4 to create a new 'current state' of the EURUSD quote (see below). This operation is performed for every message received by the client.</p>
<pre class="codehilite"><code class="language-JSON">{
  "ContextId": "MyConnectionID",
  "Format": "application/json",
  "InactivityTimeout": 30,
  "ReferenceId": "SubscriptionReference",
  "RefreshRate": 1000,
  "Snapshot": {
    "Data": [
      {
        "AssetType": "FxSpot",
        "LastUpdated": "2020-02-11T09:38:30.972000Z",
        "PriceSource": "SBFX",
        "Quote": {
          "Amount": 100000,
          "Ask": 1.09148,
          "Bid": 1.09147,
          "DelayedByMinutes": 0,
          "ErrorCode": "None",
          "Mid": 1.091475,
          "PriceSource": "SBFX",
          "PriceSourceType": "Firm",
          "PriceTypeAsk": "Tradable",
          "PriceTypeBid": "Tradable"
      },
      "Uic": 21
      }
    ]
  },
  "State": "Active"
}</code></pre>

</li>
</ol>
<p>In the above overview, note that:</p>
<ul>
<li>A single WebSocket connection can serve multiple subscriptions, which are individually created and deleted when the context requires it.</li>
<li>The WebSocket connection is exclusively used for listening to messages. Only the closing handshake requires the client app to send a message onto the connection to initiate the closing handshake. Any other messages sent by the client are ignored by the streaming server.</li>
</ul>
<h2 id="removing-a-subscription">Removing a Subscription<a class="headerlink" href="#removing-a-subscription" title="Permanent link">&para;</a></h2>
<p>When a subscription becomes obsolete, for instance when the user has 'moved on' to a different section in the app's UI that does not require certain data to continue flowing, the app should perform cleanup. This prevents unnecessary overhead on the client and server side, and ensures that the session stays within throttling limits (see below). Subscriptions are created and deleted on the same path (in our example, <code>trade/v1/infoprices/subscriptions/</code>). For deletion, the <code>ContextID</code> and <code>SubscriptionReference</code> are added as path parameters:</p>
<pre class="codehilite"><code class="language-HTTP">DELETE /sim/openapi/trade/v1/infoprices/subscriptions/{ContextID}/{SubscriptionReference} HTTP/1.1
Host: gateway.saxobank.com
Authorization: Bearer [token]</code></pre>

<p>The OpenAPI confirms deletion by returning <code>HTTP 202 Accepted</code>.</p>
<h2 id="decoding-data-messages">Decoding Data Messages<a class="headerlink" href="#decoding-data-messages" title="Permanent link">&para;</a></h2>
<p>The client application is expected to decode the byte layout of each individual message, which follows the below pattern:</p>
<table>
<thead>
<tr>
<th>Byte index</th>
<th>Size (bytes)</th>
<th>Description</th>
<th>Example value</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>8</td>
<td><strong>Message identifier</strong> <br/> 64-bit little-endian unsigned integer uniquely identifying each message, starting at <code>1</code> for the first message. Can roll over or be reset during a session.</td>
<td><code>31</code></td>
</tr>
<tr>
<td>8</td>
<td>2</td>
<td><strong>Reserved</strong> <br/> Reserved bytes for future use - to be ignored by the client application.</td>
<td></td>
</tr>
<tr>
<td>10</td>
<td>1</td>
<td><strong>Reference ID size</strong> <code>RefSize</code> <br/> Number of bytes that make up the Reference ID of the subscription that this message belongs to.</td>
<td><code>15</code></td>
</tr>
<tr>
<td>11</td>
<td><code>RefSize</code></td>
<td><strong>Reference ID</strong> <br/> ASCII-encoded Reference ID corresponding to the subscription that this message belongs to or to pre-defined control messages, which always start with an underscore <code>_</code> (see below).</td>
<td><code>SubscriptionReference</code>  or <code>_heartbeat</code></td>
</tr>
<tr>
<td>11 + <code>RefSize</code></td>
<td>1</td>
<td><strong>Payload format</strong> <br/> 8-bit unsigned integer signaling the format of the payload. Value will be <code>0</code> for data messages and control messages to signal payload is a UTF-8 encoded text string containing JSON.</td>
<td><code>0</code></td>
</tr>
<tr>
<td>12 + <code>RefSize</code></td>
<td>4</td>
<td><strong>Payload size</strong> <code>PlSize</code> <br/> 32-bit little-endian unsigned integer indicating the size of the payload contained in this message.</td>
<td><code>108</code></td>
</tr>
<tr>
<td>16 + <code>RefSize</code></td>
<td><code>PlSize</code></td>
<td><strong>Message payload</strong> <br/> UTF-8 encoded message payload, which decodes to a string representing a JSON object. This string should be deserialized into a JSON object by the client application.</td>
<td><em>See update message above</em></td>
</tr>
</tbody>
</table>
<h2 id="disconnecting-and-reconnecting">Disconnecting and Reconnecting<a class="headerlink" href="#disconnecting-and-reconnecting" title="Permanent link">&para;</a></h2>
<p>The client can disconnect from the streaming server by sending a close frame. The server will respond with a close frame of its own, as per the <a href="https://tools.ietf.org/html/rfc6455#section-5.5.1">WebSocket protocol</a>. Closing a WebSocket connection automatically deletes any associated subscriptions.</p>
<p>In case an unforeseen event causes the connection to be dropped on the transport level, the client app can reconnect to the streaming server and provide the ID of the last-seen message as a parameter. This allows for an automatic fallback to be implemented on the client side where the disruption towards the end user is as limited as possible. The streaming server caches a limited number of recent messages for this purpose. The below request provides an example of a reconnection request with the <code>MessageId</code> parameter set to 10:</p>
<pre class="codehilite"><code class="language-HTTP">GET /sim/openapi/streamingws/connect?ContextId=[ID]&amp;MessageId=10 HTTP/1.1
Connection: Upgrade
Upgrade: WebSocket
Sec-WebSocket-Key: [auto-generated key]
Sec-WebSocket-Version: 13
Authorization: Bearer [token]
Host: streaming.saxobank.com</code></pre>

<p>Once the connection is established, the streaming server will pick up from message 11 onwards and immediately send all missed intermediate messages so the client can 'catch up'. </p>
<h2 id="resetting-subscriptions">Resetting Subscriptions<a class="headerlink" href="#resetting-subscriptions" title="Permanent link">&para;</a></h2>
<p>In the event the streaming server detects failures such as message loss, it will send a <code>_resetsubscriptions</code> control message. This message can include a list labeled <code>TargetReferenceIds</code>, but it can also be empty signaling that <em>all</em> subscriptions need to be reset. In order to reset an existing subscription, first send a <code>DELETE</code> request before re-sending the <code>POST</code> request to prevent throttling from interfering with the reset process (see below). An example of the <code>_resetsubscriptions</code> control message:</p>
<pre class="codehilite"><code class="language-JSON">{
  "ReferenceId": "_resetsubscriptions",
  "Timestamp": "2020-02-11T15:14:22.776000Z",
  "TargetReferenceIds": [
    "SubscriptionReference"
  ]
}</code></pre>

<h2 id="throttling">Throttling<a class="headerlink" href="#throttling" title="Permanent link">&para;</a></h2>
<h2 id="re-authorizing">Re-Authorizing<a class="headerlink" href="#re-authorizing" title="Permanent link">&para;</a></h2>
<h2 id="control-messages">Control Messages<a class="headerlink" href="#control-messages" title="Permanent link">&para;</a></h2>
<h2 id="keeping-state-on-the-client-side">Keeping State on the Client Side<a class="headerlink" href="#keeping-state-on-the-client-side" title="Permanent link">&para;</a></h2>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Even if an application would be allowed to poll the OpenAPI on every required endpoint at a rate of &gt; 1 request/s, streaming updates will always be faster as they are directly pushed from the server.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>Strictly speaking, the exact order of steps 1-3 is not important as the subscription request will automatically buffer updates until the corresponding WebSocket connection is created.&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>Delta updates offer a significant optimization in WebSocket streaming because static/unchanged fields are never sent more than once, reducing message payload size. It does however require the client-side application to merge the update with the earlier received snapshot and intermediate messages (i.e. keep state).&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
</ol>
</div>
              </span>
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../" title="Overview" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Overview
              </span>
            </div>
          </a>
        
        
          <a href="../../faq/" title="FAQ Guide" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                FAQ Guide
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 Gid van der Ven
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/SaxoBank" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/saxobank" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/company/saxo-bank/" class="md-footer-social__link fa fa-linkedin"></a>
    
      <a href="https://www.home.saxo" class="md-footer-social__link fa fa-globe"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.d151b584.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"../../.."}})</script>
      
        <script src="https://unpkg.com/mermaid@8.4.6/dist/mermaid.min.js"></script>
      
        <script src="../../../search/main.js"></script>
      
    
    <script>
      links = document.getElementsByTagName('a')
      for(let i = 0; i < links.length; i++) {
        if(links[i].getAttribute('href').startsWith('http')) {
          links[i].target = '_blank'
        }
      }
    </script>
    <script>
      timeago.render(document.querySelectorAll('.timeago'));
    </script>
  </body>
</html>